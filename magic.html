<!DOCTYPE html>
<!--
                    Contest: Magic
    
         I have completed 100% of Khan Academy's 
        'Intro to Webpages' and have been programming 
                    for 96+ months (yah, over 8 years, I started KA programming when I was like 9).
    
          I would prefer to be placed in the
                       Advanced bracket
                       
    
    IF THE PROGRAM IS LAGGING OR DOES NOT RUN:
        There are performance options bellow.
-->
<!--
    * ABOUT THE PROJECT *
    Models:
        All meshes where created by me in Blender 3.3 with no external references.
        Meshes are all created with a combination of hand-modeling and, in the case of the broken stone fragments,
          procedurally generated by geometry node scripts that I wrote.
    
    Textures/Shaders:
        All textures were procedurally generated with Blender Shader nodes.
        Again the node programming represents my work only.
    
    Code:
        Because of the complexity of this project, I couldn't imagine trying to write this all on one giant file on KA,
          so code is uploaded to GitHub facilitating development.  The repository can be found here:
          https://github.com/Rotorwing/ka-magic-contest
        
        The to make the graphics I am using Babylon JS which has many advantages such as making implement GLSL Shader code
          simpler and supporting PBR materials, however the use of this should be taken into consideration when grading this
          submission.

        Volume shaders were what made this project such a challenge, I spent a lot of time researching how volume shaders are done
          in games only to come away essential empty handed.  I'm not sure why I was so hard to find, or maybe I just didn't understand
          the techniques, so I ended up coming up with my own (although I am sure it is not an uncommon) method of implementing it.
        In the end the only outside techniques I used was the Henyey-Greenstein Phase Function and a dither matrix.
        
        All of this code represents solely my own work and effort (accumulating to well over 100 hours of work.)
-->
<html>
    <head>

        <script>
            /**  Controls */
            // Click and drag to Orbit
            // Scroll to Zoom

            /**  Performance Options! **/
            //        Recommended settings           Fast       High Quality   Info
            window.shadowMapResolutionScale = 2; //  1          4              Resolution of Shadow maps, reduces pixilation of shadows (multiple of 2 is optimal)
            window.depthPassResolution = 0.005;  //  0.01       0.001          Accuracy of volume lighting, smaller values increase number of depth checks
            window.useAntiAliasing = true;       //  false      true
            window.useBloom = true;              //  false      true
            window.useParticles = true;          //  false      true
            window.useVolumeShaders = true;      //  false      true           Turn this off if none of the other settings cut it for you

        </script>
        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            #loadingFrame {
                width: 100%;
                height: 100%;
                background-color: rgb(225, 225, 200);
                z-index: 5;
            }
            #loadingText {
                position:absolute;
                top:50%;
                left:50%;
                transform: translate(-50%, -50%);
                color: rgb(120, 150, 120);
                margin: 0;
                font-size: 3em;
            }
            #renderCanvas {
                position:absolute;
                top:0;
                left:0;
                width: 100%;
                height: 100%;
                touch-action: none;
                visibility: hidden;
            }
        </style>

        <script>
            window.doneLoading = function(){
                // Add three seconds so be sure everything is loaded
                setTimeout( function() {
                    document.getElementById("loadingFrame").style.visibility = 'hidden';
                    document.getElementById("renderCanvas").style.visibility  = 'visible';
                }, 3000);
            }
        </script>

    </head>

   <body>
    <div id = "loadingFrame">
        <div id ="loadingText">
            Loading...
        </div>
    </div>
	<canvas id="renderCanvas"></canvas>
	
	<script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/src/utils.js"></script>

    <!-- libs -->
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/libs/babylon.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/libs/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/libs/babylonjs.postProcess.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/libs/babylonjs.proceduralTextures.min.js"></script>

    <!-- glb files -->
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_0.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_1.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_2.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_3.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_4.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_5.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_6.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_7.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_8.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass4/NatureRoom/glbs/jsglbs/NatureRoom_9.js"></script>
    

    <!-- shader files -->
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass5/src/shaders/alphoverShader.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass5/src/shaders/scatteringShader.js"></script>

    <!-- sprite files -->
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass6/src/sprites/dust_converted_raw.js"></script>
    <script src = "https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass6/src/sprites/BRDF_converted_raw.js"></script>

    <!-- src -->
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass6/src/UserCamera.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass6/src/Environment.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass6/src/Sun.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass6/src/Dust.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass6/src/Scattering.js"></script>

	<!--<script>
        particleTexture = new BABYLON.Texture.LoadFromDataString("dust", _base64ToArrayBuffer(window.dust_converted));
        console.log(particleTexture);
    </script>-->
	<script src="https://cdn.jsdelivr.net/gh/Rotorwing/ka-magic-contest@jsdeliverbypass6/src/main.js"></script>
    
    <!--<script>window.doneLoading();</script>-->
   </body>


</html>